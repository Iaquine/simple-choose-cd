FROM centos/python-38-centos7
USER root

# Defina a variável BOM_PATH se for usada posteriormente
ARG BOM_PATH=/code

# Versionador de bibliotecas do Python
RUN pip install --no-cache-dir --upgrade pip==20.2.3

# Biblioteca usada para instalação de requisitos
RUN pip install --no-cache-dir --upgrade setuptools==50.3.0

ENV VERSAO=1.0.1 \
    CMAKE_C_COMPILER=/usr/bin/gcc \
    CMAKE_CXX_COMPILER=/usr/bin/g++

# Cria o diretório de trabalho primeiro
WORKDIR /code

# Copia arquivos mantendo estrutura relativa
COPY ./setup.py .
COPY ./arvore_model2.pkl .
COPY ./service ./service

# Instala dependências
RUN pip3 install pandas
RUN pip3 install -e .[dev]

# Se realmente precisar copiar o próprio Dockerfile
COPY Dockerfile.dev ${BOM_PATH}/

# Configurações (verifique se o caminho existe)
COPY ./service/config ./config

# Permissões
RUN chmod -R +x /code

CMD ["python3", "-m", "service"]
